% ===========================================================================
% header.tex (Release 2.1)
% ==========-----------------------------------------------------------------
%
% (C) in 2017-19 by Norman Markgraf (nmarkgraf(at)hotmail(dot)com)
%
% 17. Jan. 2019 (nm) Some tiny changes.
% 05. Jun. 2020 (nm) Die "colums"-Umgebung hacken, so das onlytextwidth
%                    zum default wird. Damit ragen die Spalten nicht mehr 
%                    links und rechts aus dem Frame heraus.
%
% ---------------------------------------------------------------------------

%\def\logowidth{1.3cm}
%\def\logoheight{1.3cm}
%\def\logoxshift{-0.85cm}
%\def\logoyshift{-0.85cm}

\newcommand{\handleSection}{%
  %
  % New section, not section in headline
  %
  \setbeamertemplate{headline}[nosectioninhead]
  %
  \begin{frame}
    \frametitle{\phantom{ÜgyT}}
    \vspace*{1.2em}
    \vspace*{7cm}
    \begin{tikzpicture}[remember picture, overlay]
        \node[% section title
          xshift=\logoxshift-6.6cm,
          yshift=3.8cm, 
          inner sep=0pt
        ] at (current page.south east){%
            \makebox[\sectiontitleboxwidth][r]{%
              {%
                \usebeamercolor{sectionnumber title}%
                \usebeamerfont{sectionnumber title}\insertsectionnumber\hspace*{0.15em}%
              }%
              {%
                \usebeamercolor[fg]{section title}%
                \usebeamerfont{section title}\NoHyper\insertsectionhead\endNoHyper%
              }
            }% makebox
        };%
    \end{tikzpicture}%
  \end{frame}
  % Reset headline. Put section in head
  \setbeamertemplate{headline}[sectioninhead]
}

\newcommand{\handleSectionStar}{%
  %
  % New section, not section in headline
  %
  \setbeamertemplate{headline}[nosectioninhead]
  %
  \begin{frame}
    \frametitle{\phantom{ÜgyT}}
    \vspace*{1.2em}
    \vspace*{7cm}
    \begin{tikzpicture}[remember picture, overlay]
        \node[% section title
          xshift=\logoxshift-6.6cm,
          yshift=3.8cm, 
          inner sep=0pt
        ] at (current page.south east){%
            \makebox[\sectiontitleboxwidth][r]{%
              {%
                \usebeamercolor[fg]{section title}%
                \usebeamerfont{section title}\NoHyper\insertsectionhead\endNoHyper%
              }
            }% makebox
        };
    \end{tikzpicture}%
  \end{frame}
  % Reset headline. Put section in head
  \setbeamertemplate{headline}[sectioninhead]

}


\AtBeginSection[\handleSectionStar]{\handleSection}

\newcommand{\handleSubsection}{%
  %
  % New subsection, not section in headline
  %
  \setbeamertemplate{headline}[nosectioninhead]
  %
  \begin{frame}
    \frametitle{\phantom{ÜgyT}}
    \vspace*{1.2em}
    \vspace*{7cm}
    \begin{tikzpicture}[remember picture, overlay]
        \node[% section title
          xshift=\logoxshift-6.6cm,
          %anchor=south east,
          yshift=3.8cm, 
          inner sep=0pt
        ] at (current page.south east){%
%          \fbox{
            \makebox[\sectiontitleboxwidth][r]{%
              {%
                \usebeamercolor{sectionnumber title}%
                \usebeamerfont{sectionnumber title}\insertsectionnumber.%\insertsubsectionnumber\hspace*{0.15em}%
              }%
              {%
                \usebeamercolor{subsectionnumber title}%
                \usebeamerfont{subsectionnumber title}\insertsubsectionnumber\hspace*{0.15em}%
              }%
              {%
                \usebeamercolor[fg]{subsection title}%
                \usebeamerfont{subsection title}\NoHyper\insertsubsectionhead\endNoHyper%
              }
            }% makebox
%          }% fbox
        };
    \end{tikzpicture}%
  \end{frame}
  % Reset headline. Put section in head
  \setbeamertemplate{headline}[sectioninhead]
%  \addtocounter{framenumber}{-1}% If you don't want them to affect the slide number

}

\newcommand{\handleSubsectionStar}{%
  %
  % New subsection, not section in headline
  %
  \setbeamertemplate{headline}[nosectioninhead]
  %
  \begin{frame}
    \frametitle{\phantom{ÜgyT}}
    \vspace*{1.2em}
    \vspace*{7cm}
    \begin{tikzpicture}[remember picture, overlay]
      \node[% section title
          xshift=\logoxshift-6.6cm,
          %anchor=south east,
          yshift=3.8cm, 
          inner sep=0pt
      ] at (current page.south east){%
%          \fbox{
            \makebox[\sectiontitleboxwidth][r]{%
              {%
                \usebeamercolor[fg]{subsection title}%
                \usebeamerfont{subsection title}\NoHyper\insertsubsectionhead\endNoHyper%
              }
            }% makebox
%          }% fbox
    };% war mal -3pt
    \end{tikzpicture}%
  \end{frame}
  % Reset headline. Put section in head
  \setbeamertemplate{headline}[sectioninhead]
}


\AtBeginSubsection[\handleSubsectionStar]{\handleSubsection}

%
% Remove unwanted toc entries:
%
\renewcommand\addcontentsline[3]{%
\ifthenelse{\equal{#1}{toc}}{\relax}{\addtocontents{#1}{\protect\contentsline{#2}{#3}}}
}

\setbeamertemplate{section in toc}{%
    \leavevmode\leftskip=2.75ex%
  \llap{%
    \usebeamerfont*{section number projected}%
    \usebeamercolor[bg]{section number projected}%
    \vrule width2.50ex height2.05ex depth.4ex%
    \hskip-2.50ex%
    \hbox to2.50ex{\hfil\color{fg}\inserttocsectionnumber\hfil}}%
  \kern1.35ex\inserttocsection\par}

%
% BUGFIX für caption bug in 2018!
% 
% see: https://tex.stackexchange.com/questions/426088/texlive-pretest-2018-beamer-and-subfig-collide/426090#426090
% see: https://www.mrunix.de/forums/showthread.php?77329-Undefined-control-sequence-magyar-captionfix-beim-Laden-von-subfig-in-beamer
% see: https://gitlab.com/axelsommerfeldt/caption/issues?state=opened
%
\makeatletter
\let\@@magyar@captionfix\relax
\makeatother



%
% Default für columns auf "onlytextwidth" setzen, damit die Splaten besser
% ins Bild passen.
% Quelle: https://tex.stackexchange.com/questions/204022/make-onlytextwidth-default-width-of-columns
%
\makeatletter
\long\def\beamer@newenvnoopt#1#2#3#4{%
    \expandafter\renewcommand\expandafter<\expandafter>\csname#1\endcsname[#2]{#3}%<- here
    \expandafter\long\expandafter\def\csname end#1\endcsname{#4}%
}
\long\def\beamer@newenvopt#1#2[#3]#4#5{%
    \expandafter\renewcommand\expandafter<\expandafter>\csname#1\endcsname[#2][#3]{#4}%<- here
    \expandafter\long\expandafter\def\csname end#1\endcsname{#5}%
}

\renewenvironment<>{columns}[1][]{%
    \begin{actionenv}#2%
        \def\beamer@colentrycode{%
            \hbox to\textwidth\bgroup%
            \leavevmode%
            \hskip-\beamer@leftmargin%
            \nobreak%
            \beamer@tempdim=\textwidth%
            \advance\beamer@tempdim by\beamer@leftmargin%
            \advance\beamer@tempdim by\beamer@rightmargin%
            \hbox to\beamer@tempdim\bgroup%
            \hbox{}\hfill\ignorespaces}%
        \def\beamer@colexitcode{\egroup%
            \nobreak%
            \hskip-\beamer@rightmargin\egroup}%
        \ifbeamer@centered\setkeys{beamer@col}{c}\else\setkeys{beamer@col}{t}\fi%
        \setkeys{beamer@col}{#1, onlytextwidth}% added "onlytextwidth"
        \par%
        \beamer@colentrycode%
        \def\beamer@colclose{}\ignorespaces}%
    {\beamer@colclose\def\beamer@colclose{}\beamer@colexitcode\end{actionenv}}%
\makeatother



\InputIfFileExists{include-notes.tex}{\relax}{\relax}
\InputIfFileExists{header_costums.tex}{\relax}{\relax}
% ===========================================================================
